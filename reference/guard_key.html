<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Shared secret guard — guard_key • fireproof</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Shared secret guard — guard_key"><meta name="description" content="This guard is based on a mutually shared secret between the
server and the client. The client provides the secret either as a header or
in a cookie, and the server verifies the authenticity of the secret. Like
with basic authentication, this scheme relies on additional
technology like HTTPS/SSL to make it secure since the secret can otherwise
easily be extracted from the request by man-in-the-middle attack."><meta property="og:description" content="This guard is based on a mutually shared secret between the
server and the client. The client provides the secret either as a header or
in a cookie, and the server verifies the authenticity of the secret. Like
with basic authentication, this scheme relies on additional
technology like HTTPS/SSL to make it secure since the secret can otherwise
easily be extracted from the request by man-in-the-middle attack."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fireproof</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/fireproof.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/thomasp85/fireproof/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Shared secret guard</h1>
      <small class="dont-index">Source: <a href="https://github.com/thomasp85/fireproof/blob/main/R/guard_key.R" class="external-link"><code>R/guard_key.R</code></a></small>
      <div class="d-none name"><code>guard_key.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This guard is based on a mutually shared secret between the
server and the client. The client provides the secret either as a header or
in a cookie, and the server verifies the authenticity of the secret. Like
with <a href="guard_basic.html">basic authentication</a>, this scheme relies on additional
technology like HTTPS/SSL to make it secure since the secret can otherwise
easily be extracted from the request by man-in-the-middle attack.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">guard_key</span><span class="op">(</span></span>
<span>  <span class="va">key_name</span>,</span>
<span>  <span class="va">validate</span>,</span>
<span>  user_info <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cookie <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"KeyAuth"</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-key-name">key_name<a class="anchor" aria-label="anchor" href="#arg-key-name"></a></dt>
<dd><p>The name of the header or cookie to store the secret under</p></dd>


<dt id="arg-validate">validate<a class="anchor" aria-label="anchor" href="#arg-validate"></a></dt>
<dd><p>Either a single string with the secret
or a function that will be called with the arguments <code>key</code>, <code>request</code>, and
<code>response</code> and returns <code>TRUE</code> if its a valid secret (useful if you have
multiple or rotating secrets). If the function returns a character vector it
is considered to be authenticated and the return value will be understood as
scopes the user is granted. Make sure never to store secrets in plain text
and avoid checking them into version control.</p></dd>


<dt id="arg-user-info">user_info<a class="anchor" aria-label="anchor" href="#arg-user-info"></a></dt>
<dd><p>A function to extract user information from the
key. It is called with a single argument: <code>key</code> which is the key
used for the successful authentication. The function should return a new
<a href="new_user_info.html">user_info</a> list.</p></dd>


<dt id="arg-cookie">cookie<a class="anchor" aria-label="anchor" href="#arg-cookie"></a></dt>
<dd><p>Boolean. Should the secret be transmitted as a cookie. If
<code>FALSE</code> it is expected to be transmitted as a header.</p></dd>


<dt id="arg-name">name<a class="anchor" aria-label="anchor" href="#arg-name"></a></dt>
<dd><p>The name of the guard</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <a href="GuardKey.html">GuardKey</a> object</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This authentication is not a classic HTTP authentication scheme and thus
doesn't return a <code>401</code> response with a <code>WWW-Authenticate</code> header. Instead it
returns a <code>400</code> response unless another guard has already set the
response status to something else.</p>
    </div>
    <div class="section level2">
    <h2 id="user-information">User information<a class="anchor" aria-label="anchor" href="#user-information"></a></h2>
    <p><code>guard_key()</code> automatically adds <a href="new_user_info.html">user information</a> after
authentication. By default it will set the <code>provider</code> field to <code>"local"</code>.
Further, it will set the <code>scopes</code> field to any scopes returned by the
<code>validate</code> function (provided <code>validate</code> is passed a function).</p>
<p>Since key-based authentication is seldom used with user specific keys it is
unlikely that it makes sense to populate the information any further.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Create a guard of dubious quality</span></span></span>
<span class="r-in"><span><span class="va">key</span> <span class="op">&lt;-</span> <span class="fu">guard_key</span><span class="op">(</span></span></span>
<span class="r-in"><span>  key_name <span class="op">=</span> <span class="st">"my-key-location"</span>,</span></span>
<span class="r-in"><span>  validate <span class="op">=</span> <span class="st">"SHHH!!DONT_TELL_ANYONE"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Add it to a fireproof plugin</span></span></span>
<span class="r-in"><span><span class="va">fp</span> <span class="op">&lt;-</span> <span class="va"><a href="Fireproof.html">Fireproof</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fp</span><span class="op">$</span><span class="fu">add_guard</span><span class="op">(</span><span class="va">key</span>, <span class="st">"key_auth"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Use it in an endpoint</span></span></span>
<span class="r-in"><span><span class="va">fp</span><span class="op">$</span><span class="fu">add_auth</span><span class="op">(</span><span class="st">"get"</span>, <span class="st">"/*"</span>, <span class="va">key_auth</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Thomas Lin Pedersen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

