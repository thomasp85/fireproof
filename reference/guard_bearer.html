<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Bearer authentication guard — guard_bearer • fireproof</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Bearer authentication guard — guard_bearer"><meta name="description" content="Bearer authentication is a HTTP scheme based on tokens. It is used
in a lot of places as it is often used for transmitting the tokens issued as
part of OAuth 2.0 and OpenID Connect authentication. It is a
quite simple scheme that is based on the concept of time- and scope-limited
bearer tokens. Whoever has a valid token gains access to the resources the
token unlocks. This prevents the leaking of passwords as well as makes it easy
to rotate tokens etc. While the time-limited aspect of tokens means that an
attacker may only gain temporary access to a resource if they intercept a
token during transmission, it is still highly recommended to only transmit
tokens over HTTPS"><meta property="og:description" content="Bearer authentication is a HTTP scheme based on tokens. It is used
in a lot of places as it is often used for transmitting the tokens issued as
part of OAuth 2.0 and OpenID Connect authentication. It is a
quite simple scheme that is based on the concept of time- and scope-limited
bearer tokens. Whoever has a valid token gains access to the resources the
token unlocks. This prevents the leaking of passwords as well as makes it easy
to rotate tokens etc. While the time-limited aspect of tokens means that an
attacker may only gain temporary access to a resource if they intercept a
token during transmission, it is still highly recommended to only transmit
tokens over HTTPS"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fireproof</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/fireproof.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/thomasp85/fireproof/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Bearer authentication guard</h1>
      <small class="dont-index">Source: <a href="https://github.com/thomasp85/fireproof/blob/main/R/guard_bearer.R" class="external-link"><code>R/guard_bearer.R</code></a></small>
      <div class="d-none name"><code>guard_bearer.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Bearer authentication is a HTTP scheme based on tokens. It is used
in a lot of places as it is often used for transmitting the tokens issued as
part of OAuth 2.0 and OpenID Connect authentication. It is a
quite simple scheme that is based on the concept of time- and scope-limited
bearer tokens. Whoever has a valid token gains access to the resources the
token unlocks. This prevents the leaking of passwords as well as makes it easy
to rotate tokens etc. While the time-limited aspect of tokens means that an
attacker may only gain temporary access to a resource if they intercept a
token during transmission, it is still highly recommended to only transmit
tokens over HTTPS</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">guard_bearer</span><span class="op">(</span></span>
<span>  <span class="va">validate</span>,</span>
<span>  user_info <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  realm <span class="op">=</span> <span class="st">"private"</span>,</span>
<span>  allow_body_token <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  allow_query_token <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"BearerAuth"</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-validate">validate<a class="anchor" aria-label="anchor" href="#arg-validate"></a></dt>
<dd><p>A function that will be called with the arguments
<code>token</code>, <code>realm</code>, <code>request</code>, and <code>response</code> and returns <code>TRUE</code> if the token
is valid, and <code>FALSE</code> otherwise. If the function returns a character vector
it is considered to be authenticated and the return value will be understood
as scopes the user is granted.</p></dd>


<dt id="arg-user-info">user_info<a class="anchor" aria-label="anchor" href="#arg-user-info"></a></dt>
<dd><p>A function to extract user information from the
token. It is called with a single argument: <code>token</code> which is the token
used for the successful authentication. The function should return a new
<a href="new_user_info.html">user_info</a> list.</p></dd>


<dt id="arg-realm">realm<a class="anchor" aria-label="anchor" href="#arg-realm"></a></dt>
<dd><p>The realm this authentication corresponds to. Will be returned
to the client on a failed authentication attempt to inform them of the
credentials required, though most often these days it is kept from the user.</p></dd>


<dt id="arg-allow-body-token">allow_body_token<a class="anchor" aria-label="anchor" href="#arg-allow-body-token"></a></dt>
<dd><p>Should it be allowed to pass the token in the request
body as a query form type with the <code>access_token</code> name. Defaults to <code>TRUE</code>
but you can turn it off to force the client to use the <code>Authorization</code>
header.</p></dd>


<dt id="arg-allow-query-token">allow_query_token<a class="anchor" aria-label="anchor" href="#arg-allow-query-token"></a></dt>
<dd><p>Should it be allowed to pass the token in the query
string of the url with the <code>access_token</code> name. Default to <code>FALSE</code> due to
severe security implications but can be turned on if you have very
well-thought-out reasons to do so.</p></dd>


<dt id="arg-name">name<a class="anchor" aria-label="anchor" href="#arg-name"></a></dt>
<dd><p>The name of the guard</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <a href="GuardBearer.html">GuardBearer</a> R6 object</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This <code>validate</code> function is provided by the user and is used to test the
provided token. The complexity of the test fully depends on the issuer of the
token. At it's simplest the token is opaque and the function test it against
a database. However, it is more common to use a JSON web token to encode various
information into the token itself that can help in determining scoped access
etc.</p>
<p>The <code>validate</code> function should not test the scope of the token, but
rather return a vector of scopes (which implicitly means that the token is
valid). The scope requirement of the exact endpoint will then be tested
automatically.</p>
    </div>
    <div class="section level2">
    <h2 id="user-information">User information<a class="anchor" aria-label="anchor" href="#user-information"></a></h2>
    <p><code>guard_bearer()</code> automatically adds <a href="new_user_info.html">user information</a> after
authentication. By default it will set the <code>provider</code> field to <code>"local"</code>.
Further, it will set the <code>scopes</code> field to any scopes returned by the
<code>validate</code> function and the <code>token</code> field to a list with the following
elements:</p><ul><li><p><code>access_token</code>: The provided token</p></li>
<li><p><code>token_type</code>: <code>"bearer"</code></p></li>
<li><p><code>scope</code> The scopes concatenated into a space separated string</p></li>
</ul><p>This structure mimics the structure of the token information returned by
OAuth 2.0 and OpenID Connect services.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p><a href="https://datatracker.ietf.org/doc/html/rfc6750" class="external-link">Bearer authentication RFC</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Create a guard of dubious quality</span></span></span>
<span class="r-in"><span><span class="va">bearer</span> <span class="op">&lt;-</span> <span class="fu">guard_bearer</span><span class="op">(</span></span></span>
<span class="r-in"><span>  validate <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">token</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">token</span> <span class="op">==</span> <span class="st">"abcd1234"</span></span></span>
<span class="r-in"><span>  <span class="op">}</span>,</span></span>
<span class="r-in"><span>  user_info <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">user</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="new_user_info.html">new_user_info</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      name_given <span class="op">=</span> <span class="st">"Thomas"</span>,</span></span>
<span class="r-in"><span>      name_middle <span class="op">=</span> <span class="st">"Lin"</span>,</span></span>
<span class="r-in"><span>      name_family <span class="op">=</span> <span class="st">"Pedersen"</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span>,</span></span>
<span class="r-in"><span>  allow_body_token <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Add it to a fireproof plugin</span></span></span>
<span class="r-in"><span><span class="va">fp</span> <span class="op">&lt;-</span> <span class="va"><a href="Fireproof.html">Fireproof</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fp</span><span class="op">$</span><span class="fu">add_guard</span><span class="op">(</span><span class="va">bearer</span>, <span class="st">"bearer_auth"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Use it in an endpoint</span></span></span>
<span class="r-in"><span><span class="va">fp</span><span class="op">$</span><span class="fu">add_auth</span><span class="op">(</span><span class="st">"get"</span>, <span class="st">"/*"</span>, <span class="va">bearer_auth</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Thomas Lin Pedersen, Posit, PBC.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

