<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Guard based on OpenID Connect — guard_oidc • fireproof</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Guard based on OpenID Connect — guard_oidc"><meta name="description" content="OpenID Connect is an authentication standard build on top of
OAuth 2.0. OAuth 2.0 at its core is only about authorization
and doesn't provide a standardized approach to extracting user information
that can be used for authentication. OpenID Connect fills this gap in a
number of ways. First, the token returned is a JSON Web Token (JWT) that
contains claims about the user, signed by the issuer. Second, the
authentication service provides means for discovery of all relevant end
points making rotation of credentials etc easier. Third, the claims about
users are standardized so authentication services are easily interchangable.
Not all OAuth 2.0 authorization services provide an OpenID Connect layer, but
if they do, it is generally preferable to use that. The guard_oidc()
function is the base constructor which can be used to create authenticators
with any provider. For ease of use fireproof comes with a range of
predefined constructors for popular services such as Google etc. Central for
all of these is the need for your server to register itself with the
provider and get a client id and a client secret which must be used when
logging users in."><meta property="og:description" content="OpenID Connect is an authentication standard build on top of
OAuth 2.0. OAuth 2.0 at its core is only about authorization
and doesn't provide a standardized approach to extracting user information
that can be used for authentication. OpenID Connect fills this gap in a
number of ways. First, the token returned is a JSON Web Token (JWT) that
contains claims about the user, signed by the issuer. Second, the
authentication service provides means for discovery of all relevant end
points making rotation of credentials etc easier. Third, the claims about
users are standardized so authentication services are easily interchangable.
Not all OAuth 2.0 authorization services provide an OpenID Connect layer, but
if they do, it is generally preferable to use that. The guard_oidc()
function is the base constructor which can be used to create authenticators
with any provider. For ease of use fireproof comes with a range of
predefined constructors for popular services such as Google etc. Central for
all of these is the need for your server to register itself with the
provider and get a client id and a client secret which must be used when
logging users in."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fireproof</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/fireproof.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/thomasp85/fireproof/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Guard based on OpenID Connect</h1>
      <small class="dont-index">Source: <a href="https://github.com/thomasp85/fireproof/blob/main/R/guard_oidc.R" class="external-link"><code>R/guard_oidc.R</code></a></small>
      <div class="d-none name"><code>guard_oidc.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>OpenID Connect is an authentication standard build on top of
<a href="guard_oauth2.html">OAuth 2.0</a>. OAuth 2.0 at its core is only about authorization
and doesn't provide a standardized approach to extracting user information
that can be used for authentication. OpenID Connect fills this gap in a
number of ways. First, the token returned is a JSON Web Token (JWT) that
contains claims about the user, signed by the issuer. Second, the
authentication service provides means for discovery of all relevant end
points making rotation of credentials etc easier. Third, the claims about
users are standardized so authentication services are easily interchangable.
Not all OAuth 2.0 authorization services provide an OpenID Connect layer, but
if they do, it is generally preferable to use that. The <code>guard_oidc()</code>
function is the base constructor which can be used to create authenticators
with any provider. For ease of use <code>fireproof</code> comes with a range of
predefined constructors for popular services such as Google etc. Central for
all of these is the need for your server to register itself with the
provider and get a client id and a client secret which must be used when
logging users in.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">guard_oidc</span><span class="op">(</span></span>
<span>  <span class="va">service_url</span>,</span>
<span>  <span class="va">redirect_url</span>,</span>
<span>  <span class="va">client_id</span>,</span>
<span>  <span class="va">client_secret</span>,</span>
<span>  grant_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"authorization_code"</span>, <span class="st">"password"</span><span class="op">)</span>,</span>
<span>  oauth_scopes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"profile"</span><span class="op">)</span>,</span>
<span>  request_user_info <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  validate <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">info</span><span class="op">)</span> <span class="cn">TRUE</span>,</span>
<span>  redirect_path <span class="op">=</span> <span class="fu"><a href="get_path.html">get_path</a></span><span class="op">(</span><span class="va">redirect_url</span><span class="op">)</span>,</span>
<span>  on_auth <span class="op">=</span> <span class="va">replay_request</span>,</span>
<span>  service_name <span class="op">=</span> <span class="va">service_url</span>,</span>
<span>  service_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"OIDCAuth"</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-service-url">service_url<a class="anchor" aria-label="anchor" href="#arg-service-url"></a></dt>
<dd><p>The url to the authentication service</p></dd>


<dt id="arg-redirect-url">redirect_url<a class="anchor" aria-label="anchor" href="#arg-redirect-url"></a></dt>
<dd><p>The URL the authorization server should redirect to
following a successful authorization. Must be equivalent to one provided
when registering your application</p></dd>


<dt id="arg-client-id">client_id<a class="anchor" aria-label="anchor" href="#arg-client-id"></a></dt>
<dd><p>The ID issued by the authorization server when
registering your application</p></dd>


<dt id="arg-client-secret">client_secret<a class="anchor" aria-label="anchor" href="#arg-client-secret"></a></dt>
<dd><p>The secret issued by the authorization server when
registering your application. Do NOT store this in plain text</p></dd>


<dt id="arg-grant-type">grant_type<a class="anchor" aria-label="anchor" href="#arg-grant-type"></a></dt>
<dd><p>The type of authorization scheme to use, either
<code>"authorization_code"</code> or <code>"password"</code></p></dd>


<dt id="arg-oauth-scopes">oauth_scopes<a class="anchor" aria-label="anchor" href="#arg-oauth-scopes"></a></dt>
<dd><p>Optional character vector of scopes to request the
user to grant you during authorization. These will <em>not</em> influence the
scopes granted by the <code>validate</code> function and fireproof scoping. If named,
the names are taken as scopes and the elements as descriptions of the scopes,
e.g. given a scope, <code>read</code>, it can either be provided as <code>c("read")</code> or
<code>c(read = "Grant read access")</code></p></dd>


<dt id="arg-request-user-info">request_user_info<a class="anchor" aria-label="anchor" href="#arg-request-user-info"></a></dt>
<dd><p>Logical. Should the userinfo endpoint be followed to
add information about the user not present in the JWT token. Setting this to
<code>TRUE</code> will add an additional API call to your authentication flow but
potentially provide richer information about the user.</p></dd>


<dt id="arg-validate">validate<a class="anchor" aria-label="anchor" href="#arg-validate"></a></dt>
<dd><p>Function to validate the user once logged in. It will be
called with a single argument <code>info</code>, which gets the information of the user
as provided by the <code>user_info</code> function in the. By default it returns <code>TRUE</code>
on everything meaning that anyone who can log in with the provider will
be accepted, but you can provide a different function to e.g. restrict
access to certain user names etc. If the function returns a
character vector it is considered to be authenticated and the return value
will be understood as scopes the user is granted.</p></dd>


<dt id="arg-redirect-path">redirect_path<a class="anchor" aria-label="anchor" href="#arg-redirect-path"></a></dt>
<dd><p>The path that should capture redirects after
successful authorization. By default this is derived from <code>redirect_url</code>
by removing the domain part of the url, but if for some reason this
doesn't yields the correct result for your server setup you can overwrite
it here.</p></dd>


<dt id="arg-on-auth">on_auth<a class="anchor" aria-label="anchor" href="#arg-on-auth"></a></dt>
<dd><p>A function which will handle the result of a successful
authorization. It will be called with four arguments: <code>request</code>, <code>response</code>,
<code>session_state</code>, and <code>server</code>. The first contains the current request
being responded to, the second is the response being send back, the third
is a list recording the state of the original request which initiated the
authorization (containing <code>method</code>, <code>url</code>, <code>headers</code>, and <code>body</code> fields
with information from the original request). By default it will use
<a href="on_auth.html">replay_request</a> to internally replay the original request and send back
the response.</p></dd>


<dt id="arg-service-name">service_name<a class="anchor" aria-label="anchor" href="#arg-service-name"></a></dt>
<dd><p>The name of the service provider. Will be passed on to
the <code>provider</code> slot in the user info list</p></dd>


<dt id="arg-service-params">service_params<a class="anchor" aria-label="anchor" href="#arg-service-params"></a></dt>
<dd><p>A named list of additional query params to add to
the url when constructing the authorization url in the
<code>"authorization_code"</code> grant type</p></dd>


<dt id="arg-name">name<a class="anchor" aria-label="anchor" href="#arg-name"></a></dt>
<dd><p>The name of the guard</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An <a href="GuardOIDC.html">GuardOIDC</a> object</p>
    </div>
    <div class="section level2">
    <h2 id="user-information">User information<a class="anchor" aria-label="anchor" href="#user-information"></a></h2>
    <p><code>guard_oidc()</code> automatically adds <a href="new_user_info.html">user information</a> after
authentication, based on the standardized user claims provided in the
<code>id_token</code> as well as any additional user information provided at the
<code>userinfo_endpoint</code> of the service if <code>request_user_info = TRUE</code>. You can see
a list of standard user information defined by OpenID Connect at the
<a href="https://openid.net/specs/openid-connect-core-1_0.html#StandardClaims" class="external-link">OpenID website</a>.
The mapping of these to <code><a href="new_user_info.html">new_user_info()</a></code> is as follows:</p><ul><li><p><code>sub</code> -&gt; <code>id</code></p></li>
<li><p><code>name</code> -&gt; <code>name_display</code></p></li>
<li><p><code>given_name</code> -&gt; <code>name_given</code></p></li>
<li><p><code>middle_name</code> -&gt; <code>name_middle</code></p></li>
<li><p><code>family_name</code> -&gt; <code>name_family</code></p></li>
<li><p><code>email</code> -&gt; <code>emails</code></p></li>
<li><p><code>picture</code> -&gt; <code>photos</code></p></li>
</ul><p>Further, it will set the <code>scopes</code> field to any scopes returned by the
<code>validate</code> function, the <code>provider</code> field to <code>service_name</code>, the <code>token</code>
field to the token information as described in <code><a href="guard_oauth2.html">guard_oauth2()</a></code>, and <code>.raw</code> to
the full list of user information as provided unaltered by the service. Be
aware that the information reported by the service depends on the <code>oauth_scopes</code>
requested by fireproof and granted by the user. You can therefore never
assume the existence of any information besides <code>id</code>, <code>provider</code> and <code>token</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Example using Google endpoint (use `guard_google()` in real code)</span></span></span>
<span class="r-in"><span><span class="va">google</span> <span class="op">&lt;-</span> <span class="fu">guard_oidc</span><span class="op">(</span></span></span>
<span class="r-in"><span>  service_url <span class="op">=</span> <span class="st">"https://accounts.google.com/"</span>,</span></span>
<span class="r-in"><span>  redirect_url <span class="op">=</span> <span class="st">"https://example.com/auth"</span>,</span></span>
<span class="r-in"><span>  client_id <span class="op">=</span> <span class="st">"MY_APP_ID"</span>,</span></span>
<span class="r-in"><span>  client_secret <span class="op">=</span> <span class="st">"SUCHASECRET"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Add it to a fireproof plugin</span></span></span>
<span class="r-in"><span><span class="va">fp</span> <span class="op">&lt;-</span> <span class="va"><a href="Fireproof.html">Fireproof</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fp</span><span class="op">$</span><span class="fu">add_guard</span><span class="op">(</span><span class="va">google</span>, <span class="st">"google_auth"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Use it in an endpoint</span></span></span>
<span class="r-in"><span><span class="va">fp</span><span class="op">$</span><span class="fu">add_auth</span><span class="op">(</span><span class="st">"get"</span>, <span class="st">"/*"</span>, <span class="va">google_auth</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Thomas Lin Pedersen, Posit, PBC.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

